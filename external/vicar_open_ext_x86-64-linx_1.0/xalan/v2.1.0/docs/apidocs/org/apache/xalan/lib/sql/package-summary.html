<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc on Tue May 22 16:48:05 EDT 2001 -->
<TITLE>
Xalan-Java 2: Package org.apache.xalan.lib.sql
</TITLE>
<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../../stylesheet.css" TITLE="Style">
</HEAD>
<BODY BGCOLOR="white">

<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_top"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT ID="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-use.html"><FONT ID="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT ID="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT ID="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT ID="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT ID="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../org/apache/xalan/lib/package-summary.html"><B>PREV PACKAGE</B></A>&nbsp;
&nbsp;<A HREF="../../../../../org/apache/xalan/processor/package-summary.html"><B>NEXT PACKAGE</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html" TARGET="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" TARGET="_top"><B>NO FRAMES</B></A></FONT></TD>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->

<HR>
<H2>
Package org.apache.xalan.lib.sql
</H2>
Provides extension functions for connecting to a JDBC data source, executing a query,
    and working incrementally through a "streamable" result set.
<P>
<B>See: </B>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#package_description"><B>Description</B></A>
<P>

<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Interface Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="ConnectionPool.html"><I>ConnectionPool</I></A></B></TD>
<TD>
 This interface specification is used to define how Xalan will
 interact with a Connection Pool.</TD>
</TR>
</TABLE>
&nbsp;

<P>

<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Class Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="Column.html">Column</A></B></TD>
<TD>
 A JDBC Query returns a resultSet that contains rows of
 Data.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="ColumnAttribute.html">ColumnAttribute</A></B></TD>
<TD>Represents a column attribute on a column-header element.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="ColumnData.html">ColumnData</A></B></TD>
<TD>Represents the col element text node, i.e., the column value.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="ColumnHeader.html">ColumnHeader</A></B></TD>
<TD>
 The ColumnHeader is a special branch of the document that provides
 a mechinsim to interogate columns that are returned from the query
 without accessing the data or moving the row counter.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="DefaultConnectionPool.html">DefaultConnectionPool</A></B></TD>
<TD>
 The default connection pool was implemented so that all connection
 to JDBC data sources use connection pools.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="ExtensionError.html">ExtensionError</A></B></TD>
<TD><i><font size="-1" color="#0000FF">**Experimental** </font></i><meta name="usage" content="experimental"/>
 </TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="PooledConnection.html">PooledConnection</A></B></TD>
<TD>
 A special container that wraps a standard JDBC Connection that is
 used to identify the connection inside the Connection Pool.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="QueryParameter.html">QueryParameter</A></B></TD>
<TD>
 The Query Parameter is a container class that is used to hold the
 Parameter information.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="Row.html">Row</A></B></TD>
<TD>
 This class represents a row from a query result set.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="RowSet.html">RowSet</A></B></TD>
<TD>
 The row-set is the controlling element in the Document that determines
 if the JDB ResultSet is being traversed or if the ResultSet MetaData
 is being interogated.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="SQLExtensionError.html">SQLExtensionError</A></B></TD>
<TD>
 An Extension of the Extension Error Class that adds information
 about the SQL Exception.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="StreamableNode.html">StreamableNode</A></B></TD>
<TD>
 The StreamableNode really just provides a base implemtation
 for the other SQL Node based classes.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="XConnection.html">XConnection</A></B></TD>
<TD>
 The XConnection Object is the main (currently the only) interface
 into the SQL Extensions from the Transformer.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="XConnectionPoolManager.html">XConnectionPoolManager</A></B></TD>
<TD>
 The ConnectionPoolManager provides a static container that allows
 external programs, inside the same JVM, to supply a set of JDBC
 connections to the Xalan transformer.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="XStatement.html">XStatement</A></B></TD>
<TD>
 Represents a JDBC query statement.</TD>
</TR>
</TABLE>
&nbsp;

<P>
<A NAME="package_description"><!-- --></A><H2>
Package org.apache.xalan.lib.sql Description
</H2>

<P>
<p>Provides extension functions for connecting to a JDBC data source, executing a query,
    and working incrementally through a "streamable" result set.<p>
   <p>The SQL Extension operates in one of two modes: streaming or cached.</p>
   <p>In streaming mode, a single row object is allocated. The contents of this object are updated as the row 
   element set is traversed. Accordingly, the result set can only be traversed once moving forward. Consider using streaming mode
    when the result set is large and memory is an issue. The number of records returned does not affect the memory footprint.</p>
   <p>In cached mode, the result set can be traversed forward or backward as many times as desired. The downside: memory is 
    consumed as the result set is traversed.</p>

   <p>Currently, the default is cached mode. To set the mode, use the enableCacheNodes() or disableCahcedNodes() method.</p>
   <p>
   <hr>
   <em>**Experimental**</em> This package is experimental. Streaming mode is not fully implemented and may not return the entire 
   result set. If you do use streaming mode, be careful not to attempt to traverse the result set in any manner other than a
   single traversal from start to finish.
   <HR>
   </p>

    <p>XConnection provides three extension functions that you can use in your stylesheet.</p>
    <A HREF="../../../../../org/apache/xalan/lib/sql/XConnection.html"><CODE>XConnection</CODE></A>
    <ol>
      <li>new() -- Use one of the XConnection constructors to connect to a data source, and return an XConnection
       object. You can use one of the constructors creates a connection pool from which stylesheets can obtain connections
       to a data source. To support connection pools, SQL library includes a Connection-Pool interface and a implementation:
       DefaultConnectionPool. You can also provide your own Connection-Pool implementation.<br/><br/></li>
      <li>query() -- Use the XConnection object query() method to return a "streamable" result set in the form of a row-set
       node. Work your way through the row-set one row at a time. The same row element is used over and over again, so you can
       begin "transforming" the row-set before the entire result set has been returned.<br/><br/></li>
       <li>pquery(), addParameter(), addParameterFromElement(), clearParameters() -- Use the XConnection pquery() method in
       conjunction with these other methods to set up and execute parameterized queries.<br/><br/></li>
       <li>enableCacheNodes(), disableCacheNodes() -- Use these XConnection methods to cache the result set or use a single row
        element to stream through the result set.<br/><br/></li>
      <li>close() -- Use the XConnection object close() method to terminate the connection.</li>
    </ol>
    <p>The query() or pquery() extension function returns a Document node that contains (as needed) an array of column-header elements,
    a single row element that is used repeatedly, and an array of col elements. Each column-header element (one per column in the
    row-set) contains an attribute (ColumnAttribute) for each of the column descriptors in the ResultSetMetaData object.
    Each col element contains a text node with a textual representation of the value for that column in the current row.</p>

    <h2>XML Sample of the return Data</h2>
    <p>This example displays the result set from a table in a sample InstantDB database.</p>
<pre>
  &lt;Column-header attribute=value&gt;
    One column header entry for each column in the query.
    Each column header contains a set of attributes describing the MetaData
    for that column. For a list of possible attributes see ColumnAttribute.java.
    <CODE>ColumnAttribute</CODE>
  &lt;Column-header&gt;

  &lt;row-set&gt;

      &lt;row&gt;
          In Streaming Mode, Caching Disabled, only one row object is returned.
          The benefit of streaming mode is that the memory footprint is the same
          regardless of the size of the query. A downside to streaming mode is that
          the row elements can <b>ONLY BE TRAVERSED ONCE</b>. In cached mode, there
          is a new row element for each row in the result set. The row elements can
          be traversed as many times as needed.
          <b>Currently the default mode is cached, streaming mode is experimental
          and currently does not work </b>

          &lt;col&gt;Value attribute=value &lt;/col&gt;
            One column entry for each column in the query.
            Each column contains a set of attributes describing the MetaData
            for that column. Foa a list of possible attributes see ColumnAttribute.java.
          &lt;col attribute=value &gt;Value&lt;/col&gt;
          &lt;col attribute=value &gt;Value&lt;/col&gt;
      &lt;/row&gt;

  &lt;/row-set&gt;


</pre>

    <h2>Example</h2>
    <p>This example displays the result set from a table in a sample InstantDB database.</p>
<pre>&lt;?xml version="1.0"?&gt;
&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                version="1.0"
                xmlns:sql="org.apache.xalan.lib.sql.XConnection"
                extension-element-prefixes="sql"&gt;
  &lt;xsl:output method="html" indent="yes"/&gt;
  &lt;xsl:param name="query" select="'SELECT * FROM import1'"/&gt;

  &lt;xsl:template match="/"&gt;
    &lt;!-- 1. Make the connection --&gt;
    &lt;xsl:variable name="products"
                  select="sql:new('org.enhydra.instantdb.jdbc.idbDriver',
                                'jdbc:idb:D:\instantdb\Examples\sample.prp')"/&gt;
    &lt;HTML&gt;
      &lt;HEAD&gt;
      &lt;/HEAD&gt;
      &lt;BODY&gt;
        &lt;TABLE border="1"&gt;
        &lt;!--2. Execute the query --&gt;
        &lt;xsl:variable name="table" select='sql:query($products, $query)'/&gt;
          &lt;TR&gt;
          &lt;!-- Get column-label attribute from each column-header--&gt;
          &lt;xsl:for-each select="$table/row-set/column-header"&gt;
            &lt;TH&gt;&lt;xsl:value-of select="@column-label"/&gt;&lt;/TH&gt;
          &lt;/xsl:for-each&gt;
          &lt;/TR&gt;
          &lt;xsl:apply-templates select="$table/row-set/row"/&gt;
          &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
        &lt;/TABLE&gt;
      &lt;/BODY&gt;
    &lt;/HTML&gt;
    &lt;!-- 3. Close the connection --&gt;
    &lt;xsl:value-of select="sql:close($products)"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="row"&gt;
        &lt;TR&gt;
          &lt;xsl:apply-templates select="col"/&gt;
        &lt;/TR&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="col"&gt;
    &lt;TD&gt;
      &lt;!-- Here is the column data -->
      &lt;xsl:value-of select="text()"/>
    &lt;/TD>
  &lt;/xsl:template>

&lt;/xsl:stylesheet&gt;
</pre>


  <h1>Handling of SQL Errors and other exceptions in this extension</h1>
  <p>
  <HR>
   <em>**Experimental**</em> This Extension enhancement is extremelly experimental
   and is being used to test its validity. </em>
  <HR>
  </p>
  <p>
  The SQL Extension package provides a mechinism to capture errors that occur as a
  result of an SQL Exception.
  </p>
  <p>
  The document that is returned provides the Exception information along
  with the SQL Error and SQL State.

  To detect if an error occured, /ext-error can be evaluated using the xsl:test
  function. A value of true reflects that an error ha occured.

  See the sample code in java/samples/extension/sql/show-error for a working example.
  </p>

  <pre>
  <p>
  <h2>Sample of an Error Return in the event of an SQL Error</h2>
  &lt;ext-error&gt;
    &lt;exception-info&gt;
      &lt;message&gt; Message from the Exception thrown &lt;/message&gt;
        &lt;sql-error&gt;
          &lt;error-code&gt; The SQL Error Code returned by the driver&lt;/error-code&gt;
          &lt;state&gt; The Current SQL Connection State &lt;/state&gt;
        &lt;/sql-error&gt;
    &lt;/exception-info&gt;
  &lt;/ext-error&gt;
  </p>
  </pre>
<P>
<HR>

<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_bottom"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT ID="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-use.html"><FONT ID="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT ID="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT ID="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT ID="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT ID="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../org/apache/xalan/lib/package-summary.html"><B>PREV PACKAGE</B></A>&nbsp;
&nbsp;<A HREF="../../../../../org/apache/xalan/processor/package-summary.html"><B>NEXT PACKAGE</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html" TARGET="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" TARGET="_top"><B>NO FRAMES</B></A></FONT></TD>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->

<HR>
Copyright © 2000 Apache XML Project. All Rights Reserved.
</BODY>
</HTML>
