##
#*******************************************************************************
#                                                                              *
# Component:                                                                   *
#                                                                              *
#    Makefile for compiling ODLC for KWVTOOL                                   *
#                                                                              *
# Make sure to compile with '-D LV_DDICT -D LV_KWVTOOL'                        *
#*******************************************************************************
##

CFLAGS = -g
DEFINES = -D SUN_UNIX -D _NO_PROTO -D PDS_TOOLBOX -D LV_DDICT -D LV_KWVTOOL
LIB_DIR = lib
ODLC_DIR = odlc
LABLIB_DIR = lablib


ODLC_LABLIB_LIB = $(LIB_DIR)/libodlc_lablib_kwvtool.a

PDS_ODLCLIB_OBJ = $(ODLC_DIR)/a_nodes.o \
	$(ODLC_DIR)/ao_nodes.o\
	$(ODLC_DIR)/p_nodes.o \
	$(ODLC_DIR)/v_nodes.o \
	$(ODLC_DIR)/lexan.o \
	$(ODLC_DIR)/parser.o \
	$(ODLC_DIR)/parsact.o \
	$(ODLC_DIR)/cvtvalue.o \
	$(ODLC_DIR)/fmtvalue.o \
	$(ODLC_DIR)/toolout.o \
	$(ODLC_DIR)/wrtlabel.o \
	$(ODLC_DIR)/rdlabel.o \
	$(ODLC_DIR)/prtlabel.o \
	$(ODLC_DIR)/comments.o \
	$(ODLC_DIR)/syslib.o \
	$(ODLC_DIR)/utillib.o

ODLC_LIB_SOURCE = $(ODLC_DIR)/a_nodes.c
PDS_LIBRARIES = $(ODLC_LABLIB_LIB)
PDS_INCLUDES =  -I$(ODLC_DIR) -I$(LABLIB_DIR)


#.SILENT:
.KEEP_STATE:
.IGONORE:

default: 
	make clean
	if [ -f $(ODLC_LIB_SOURCE) ]; then make odlc_kwvtool;  fi


odlc_kwvtool: $(PDS_ODLCLIB_OBJ)
	if [ -f $(ODLC_DIR)/parser.c ]; then \
		ar rcv $(ODLC_LABLIB_LIB) $(PDS_ODLCLIB_OBJ); \
	fi


.c.o:
	if [ -f $*.c ]; then \
	     echo Making $@; \
	     cc $(CFLAGS) $(PDS_INCLUDES) $(DEFINES) -c  $*.c -o $@; \
	else \
		exit 0; \
	fi

clean:
	touch $(ODLC_DIR)/*.o
	-rm $(ODLC_DIR)/*.o 
	-rm  $(ODLC_LABLIB_LIB)

